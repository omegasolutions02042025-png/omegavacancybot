#!/usr/bin/env python3

from __future__ import annotations

import os

from yandex_cloud_ml_sdk import YCloudML
from dotenv import load_dotenv

load_dotenv()

AUTH_TOKEN = os.getenv('AUTH_TOKEN')
FOLDER_ID = os.getenv('FOLDER_ID')


async def del_contacts_gpt(text):
    
    messages = [
        {
            "role": "system",
            "text": """
            –¢—ã ‚Äî —Ñ–∏–ª—å—Ç—Ä –≤–∞–∫–∞–Ω—Å–∏–π.
–ù–∞ –≤—Ö–æ–¥ —Ç–µ–±–µ –¥–∞–µ—Ç—Å—è —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞:

–û–ø—Ä–µ–¥–µ–ª–∏, –ø—Ä–æ—Ö–æ–¥–∏—Ç –ª–∏ –≤–∞–∫–∞–Ω—Å–∏—è –ø–æ –≤—Å–µ–º –ø—Ä–∞–≤–∏–ª–∞–º:

–õ–æ–∫–∞—Ü–∏—è:

‚úÖ –ü—Ä–æ—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ:

"–†–ë"

"–†–ë" –≤ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å—Ç—Ä–∞–Ω–∞–º–∏

"–î—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã" (–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –ê—Ä–º–µ–Ω–∏—è, –ö–∏—Ä–≥–∏–∑–∏—è, –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω, –ë–µ–ª–∞—Ä—É—Å—å)

"–õ—é–±—ã–µ" –∏–ª–∏ "–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π"

‚ùå –û—Ç—Å–µ–∫–∞–µ—Ç—Å—è, –µ—Å–ª–∏:

–£–∫–∞–∑–∞–Ω–∞ —Ç–æ–ª—å–∫–æ "–†–§"

–ü–µ—Ä–µ—á–µ–Ω—å —Å—Ç—Ä–∞–Ω, –Ω–µ –≤–∫–ª—é—á–∞—é—â–∏–π –†–ë

–£–∫–∞–∑–∞–Ω–æ "–∫—Ä–æ–º–µ –†–ë"

–ì—Ä–∞–∂–¥–∞–Ω—Å—Ç–≤–æ:

‚úÖ –ü—Ä–æ—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ:

"–†–ë"

"–†–§"

"–î—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã" (–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω, –ê—Ä–º–µ–Ω–∏—è, –ö–∏—Ä–≥–∏–∑–∏—è, –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω, –ë–µ–ª–∞—Ä—É—Å—å)

"–õ—é–±—ã–µ" –∏–ª–∏ "–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π"

‚ùå –û—Ç—Å–µ–∫–∞–µ—Ç—Å—è, –µ—Å–ª–∏:

–£–∫–∞–∑–∞–Ω—ã –¥—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã

–£–∫–∞–∑–∞–Ω–æ "–∫—Ä–æ–º–µ –†–ë"

–£—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã:

‚ùå –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã –ø—Ä–µ–≤—ã—à–∞—é—Ç: 35 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –∏–ª–∏ 50 –∫–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã—Ö –¥–Ω–µ–π –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–ø–∏—Å—å "–∞–∫—Ç—ã –ø–æ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ" –∏–ª–∏ "–ø–æ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–µ –∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" –∏–ª–∏ "–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–µ –∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" –∏–ª–∏ '–ø–æ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–∞—è –æ–ø–ª–∞—Ç–∞' –∏–ª–∏ "–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ", –≤–∞–∫–∞–Ω—Å–∏—è –æ—Ç—Å–µ–∫–∞–µ—Ç—Å—è.

‚ùå –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å —Å–ª–æ–≤–æ '—Å—Ç–æ–ø' –∏–ª–∏ "–°–¢–û–ü" —Ç–æ –≤–∞–∫–∞–Ω—Å–∏—è –æ—Ç—Å–µ–∫–∞–µ—Ç—Å—è.

–ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ –∏ –µ—Å–ª–∏ –æ–Ω–∞ –º–µ–Ω—å—à–µ —Ç—Ä–µ—Ö –º–µ—Å—è—Ü–µ–≤, –≤–∞–∫–∞–Ω—Å–∏—è –æ—Ç—Å–µ–∫–∞–µ—Ç—Å—è

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ –Ω–∞–π–¥–∏ –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å—Ä–æ–∫–æ–≤ –ø–æ–¥–∞—á–∏ —Ä–µ–∑—é–º–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ "–¥–æ DD.MM.YYYY" –∏–ª–∏ "–¥–æ DD.MM.YYYY HH:MM".  

1. –ï—Å–ª–∏ –¥–∞—Ç–∞ —É–∂–µ –ø—Ä–æ—à–ª–∞ –∏–ª–∏ —Ä–∞–≤–Ω–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç–µ, –ø—Ä–æ–ø—É—Å—Ç–∏ —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é (–Ω–µ –¥–æ–±–∞–≤–ª—è–π –µ—ë –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç).  
2. –ï—Å–ª–∏ –¥–∞—Ç–∞ –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—É–ø–∏–ª–∞, –¥–æ–±–∞–≤—å –µ—ë –≤ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π —Å–ª–æ–≤–∞—Ä—å –ø–æ–¥ –∫–ª—é—á "deadline_date".  
3. –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ –≤—Ä–µ–º—è, –¥–æ–±–∞–≤—å –µ–≥–æ –ø–æ–¥ –∫–ª—é—á "deadline_time" (–µ—Å–ª–∏ –µ—Å—Ç—å).  
4. –û—Å—Ç–∞–ª—å–Ω–æ–π —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏ –æ—Å—Ç–∞–≤—å –∫–∞–∫ –µ—Å—Ç—å.  

–§–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: —Å–ª–æ–≤–∞—Ä—å –≤–∏–¥–∞:  
{
  "text": "<–æ—á–∏—â–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏>",
  "rate": "<—Å—Ç–∞–≤–∫–∞>",
  "deadline_date": "DD.MM.YYYY" –∏–ª–∏ None,  # –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ, –∏–Ω–∞—á–µ None
  "deadline_time": "HH:MM" –∏–ª–∏ None        # –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ, –∏–Ω–∞—á–µ None
}


–ï—Å–ª–∏ –≤–∞–∫–∞–Ω—Å–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç, –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± —É—Å–ª–æ–≤–∏—è—Ö –æ–ø–ª–∞—Ç—ã.

–ï—Å–ª–∏ –≤–∞–∫–∞–Ω—Å–∏—è –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ö–æ—Ç—è –±—ã –ø–æ –æ–¥–Ω–æ–º—É –ø—Ä–∞–≤–∏–ª—É ‚Üí –≤–µ—Ä–Ω–∏ None.

–ï—Å–ª–∏ –≤–∞–∫–∞–Ω—Å–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç:

–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è. –ù–∞–π–¥–∏ –≤—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏ –≤–∏–¥–∞:
"–í–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚û°Ô∏è@username –∏–ª–∏ –≤ –æ–±—â–∏–π —á–∞—Ç. –£–∫–∞–∑–∞—Ç—å üÜî –∑–∞–ø—Ä–æ—Å–∞."
–∏ –∑–∞–º–µ–Ω–∏ –∏—Ö –Ω–∞:
"–í–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–∏—à–∏—Ç–µ –î–º–∏—Ç—Ä–∏—é ‚û°Ô∏è@Dimitryver. –£–∫–∞–∑–∞—Ç—å üÜî –∑–∞–ø—Ä–æ—Å–∞.".
–£—á—Ç–∏, —á—Ç–æ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–∏–º–≤–æ–ª üÜî –º–æ–≥—É—Ç –±—ã—Ç—å –ª—é–±—ã–º–∏.

–£–¥–∞–ª–∏ –≤—Å–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã (email, —Ç–µ–ª–µ—Ñ–æ–Ω, —Å—Å—ã–ª–∫–∏, —Ç–µ–ª–µ–≥—Ä–∞–º).

–£–¥–∞–ª–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –≤–∞–∫–∞–Ω—Å–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–≥–ª—è–¥—è—Ç –∫–∞–∫:

üÜî + –ø—Ä–æ–±–µ–ª + –∫–æ–¥ —Ñ–æ—Ä–º–∞—Ç–∞ XX-1234 (–≥–¥–µ XX ‚Äî –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ, –∞ 1234 ‚Äî —Ü–∏—Ñ—Ä—ã)

üÜî + –ø—Ä–æ–±–µ–ª + —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: üÜî 8581)

–ï—Å–ª–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–æ–∫–∏ –∏–ª–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—Å—Ç–∞, –ø—Ä–æ—Å—Ç–æ —É–±–µ—Ä–∏ –µ–≥–æ –∏ –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –≤–æ–∫—Ä—É–≥.

–û–ø—Ä–µ–¥–µ–ª–∏ —Å—Ç–∞–≤–∫—É (—Å—É–º–º—É –æ–ø–ª–∞—Ç—ã –∏–ª–∏ –¥–∏–∞–ø–∞–∑–æ–Ω) –∏ —Å–æ—Ö—Ä–∞–Ω–∏ –µ—ë –∫–∞–∫ —Å—Ç—Ä–æ–∫—É.–ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ —É–∫–∞–∑–∞–Ω—ã –¥–≤–µ —Å—Ç–∞–≤–∫–∏ ‚Äî –¥–ª—è –†–§ –∏ –¥–ª—è –Ω–µ –†–§ ‚Äî –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞–≤–∫—É –¥–ª—è –Ω–µ –†–§.
–ü—Ä–∏–º–µ—Ä:
–°—Ç–∞–≤–∫–∞ –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –†–§ 3517 / –°—Ç–∞–≤–∫–∞ –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –Ω–µ –†–§ 3120
‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 3120.
–û–±—ã—á–Ω–æ —Å—Ç–∞–≤–∫–∞ –ø–∏—à–µ—Ç—Å—è —Ç–∞–∫ : '–°—Ç–∞–≤–∫–∞ –∑–∞–∫—É–ø–∫–∏' –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏ –ø–æ—Ö–æ–∂–µ–µ –ø–æ —Å–º—ã—Å–ª—É 
–ï—Å–ª–∏ —Å—Ç–∞–≤–∫–∞ —É–∫–∞–∑–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–π –µ—ë.
–í–æ–∑–≤—Ä–∞—â–∞–π —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ, –±–µ–∑ –≤–∞–ª—é—Ç, —Å–ª–æ–≤, –∑–Ω–∞–∫–æ–≤ /, –æ—Ç, ~ –∏ —Ç.–ø.
–£–¥–∞–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å—Ç–∞–≤–∫–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞

–ù–µ –≤—ã–¥—É–º—ã–≤–∞–π –¥–∞–Ω–Ω—ã–µ. –ï—Å–ª–∏ —Å—Ç–∞–≤–∫–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –∏–ª–∏ –Ω–∞–ø–∏—Å–∞–Ω–æ –Ω–∞–ø—Ä–∏–º–µ—Ä "–°–º–æ—Ç—Ä–∏–º –≤–∞—à—É" —Ç–æ –≤–µ—Ä–Ω–∏ "rate": 0

–í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–π –≤—Å–µ –∫–ª—é—á–∏: text, rate, deadline_date, deadline_time. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî —Å—Ç–∞–≤—å None.

            """
        },
        {
            "role": "user",
            "text": text,
        },
    ]

    sdk = YCloudML(
        folder_id=FOLDER_ID,
        auth= AUTH_TOKEN,
    )



    result =(sdk.models.completions("yandexgpt").configure(temperature=0.5).run_deferred(messages, timeout = 180)).wait()
    clean_text = result.alternatives[0].text
    cleaned = clean_text.strip("`\n '")
    print(cleaned)
    print(type(cleaned))
    
    return cleaned



