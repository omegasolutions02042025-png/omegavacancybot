import google.generativeai as genai
import asyncio
import json
import re
from datetime import datetime
import os
from dotenv import load_dotenv


load_dotenv()


GEMINI_API_KEY = os.getenv('GEMINI_API_KEY')

genai.configure(api_key=GEMINI_API_KEY)


async def process_vacancy_with_gemini(text: str) -> dict | None:
    """
    ะะฝะฐะปะธะทะธััะตั ัะตะบัั ะฒะฐะบะฐะฝัะธะธ ั ะฟะพะผะพััั Gemini API, ะฒัะฟะพะปะฝัะตั ัะธะปัััะฐัะธั,
    ะพัะธััะบั ะธ ะธะทะฒะปะตัะตะฝะธะต ะดะฐะฝะฝัั ะฒ ะพะดะธะฝ ัะฐะณ.

    Args:
        text: ะกััะพะบะฐ ั ะฟะพะปะฝัะผ ัะตะบััะพะผ ะฒะฐะบะฐะฝัะธะธ.

    Returns:
        ะกะปะพะฒะฐัั (dict) ั ะธะทะฒะปะตัะตะฝะฝัะผะธ ะดะฐะฝะฝัะผะธ ะฒ ัะพัะผะฐัะต JSON
        ะธะปะธ None, ะตัะปะธ ะฒะฐะบะฐะฝัะธั ะฑัะปะฐ ะพััะธะปัััะพะฒะฐะฝะฐ.
    """
    print("๐ ะะฐะฟััะบะฐะตะผ ะพะฑัะฐะฑะพัะบั ะฒะฐะบะฐะฝัะธะธ ัะตัะตะท Gemini...")

    # ะขะตะบััะฐั ะดะฐัะฐ ะดะปั prompt
    current_date = datetime.now().strftime("%d.%m.%Y")
    current_time = datetime.now().strftime("%H:%M")
    current_tz = "+03:00"  # ะะกะ ะฟะพ ัะผะพะปัะฐะฝะธั

    # --- ะะะะะซะ ะะะะะะข ะะะฏ GEMINI ---
    system_prompt = f"""
    ะขั โ ัะธะปััั ะฒะฐะบะฐะฝัะธะน. ะะฐ ะฒัะพะด ะฟัะธัะพะดะธั ะขะะะกะข ะะะะะะกะะ. ะะฐะฑะพัะฐะน ัััะพะณะพ ะฟะพ ะฟัะฐะฒะธะปะฐะผ ะฝะธะถะต.
ะัะธ ะฟัะพัะธะฒะพัะตัะธัั ะฒัะฑะธัะฐะน ะะขะกะะงะฌ. ะะพะณะธะบะฐ ะผะตะถะดั ัะฐะทะดะตะปะฐะผะธ โ ะ (AND).
ะกะตะณะพะดะฝั: {current_date} {current_time} ({current_tz}).

ะฆะะะฌ:
1) ะะตัะธัั, ะพััะตะบะฐัั ะฒะฐะบะฐะฝัะธั ะธะปะธ ะฝะตั (ะตัะปะธ ะพััะตัั โ ะฒะตัะฝััั ััััะบัััั ั ะฟะพะปัะผะธ = null ะธ ะฒ ะฟะตัะตะผะตะฝะฝะพะน "reason" ัะบะฐะทะฐัั ะฟัะธัะธะฝั).
2) ะัะปะธ ะะ ะพััะตะบะฐัั โ ะพัะธััะธัั ะธ ะฝะพัะผะฐะปะธะทะพะฒะฐัั ัะตะบัั, ะธะทะฒะปะตัั ะฟะพะปั ะธ ะฒะตัะฝััั ัะปะพะฒะฐัั ัััะพะณะพ ะทะฐะดะฐะฝะฝะพะณะพ ัะพัะผะฐัะฐ.

ะะะะะะะฌะะะ ะะะะะะะ ะกะะฅะะะะะะะฏ ะกะขะะฃะะขะฃะะซ (ะะะะะ):
โ ะะพ ะฒัะตะผั ัะตะบััั ะฒะฐะบะฐะฝัะธะธ ะกะขะะะะ ะกะะฅะะะะฏะ ะธััะพะดะฝัั ััััะบัััั: ะฟะพััะดะพะบ ัััะพะบ ะธ ะฐะฑะทะฐัะตะฒ, ะฟััััะต ัััะพะบะธ,
  ะผะฐัะบะตัั ัะฟะธัะบะพะฒ (-, โข, โ), ะฝัะผะตัะฐัะธั (1), 1., 1), ัะธัะต/ะบะฐะฒััะบะธ, ัะผะพะดะทะธ ะธ ัะฟะตััะธะผะฒะพะปั, ัะตะณะธััั,
  ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพััะธ ะฟัะพะฑะตะปะพะฒ/ัะฐะฑะพะฒ. ะะธัะตะณะพ ะฝะต ะฟะตัะตัะพัะผะฐัะธััะน ะธ ะฝะต ยซัะบะปะตะธะฒะฐะนยป.
  ะะฐะทัะตัะตะฝะพ ัะดะฐะปััั/ะฟะตัะตะผะตัะฐัั ะขะะะฌะะ ัะฒะฝะพ ัะบะฐะทะฐะฝะฝัะต ะฝะธะถะต ััะฐะณะผะตะฝัั (ะพะฟะปะฐัะฐ/ะบะพะฝัะฐะบัั/ะทะฐะณะพะปะพะฒะบะธ ยซะฟะปััะพะฒยป/๐ ะธ ั.ะฟ.).
  ะัะต ะฟัะพัะธะต ัะธะผะฒะพะปั ะธ ะฟะตัะตะฝะพัั ะดะพะปะถะฝั ะพััะฐัััั ะฑะตะท ะธะทะผะตะฝะตะฝะธะน.

ะะะะะะะะะะฆะะ:
- ะะ โก ะะตะปะฐัััั โก Belarus โก BY โก ะะตะปะพััััะธั โก Belorussia; ะะค โก ะะพััะธั โก Russian Federation โก Russia โก RU.
- ะะพัะพะดะฐ ะะ: ะะธะฝัะบ, ะัะตัั, ะะธัะตะฑัะบ, ะะพะผะตะปั, ะัะพะดะฝะพ, ะะพะณะธะปัะฒ (ะปัะฑัะต ะฟะฐะดะตะถะธ).
- ยซะััะถะตััะฒะตะฝะฝัะต ัััะฐะฝัยป / friendly/allied countries / CIS/ะกะะ / EAEU/ะะะญะก โ ััะธัะฐะน, ััะพ ะฒะบะปััะฐัั ะะตะปะฐัััั (ะะ).
- ะััััััะฒะธะต ะพะณัะฐะฝะธัะตะฝะธะน: ยซะปัะฑะพะน/ะปัะฑะฐั/anyยป, ยซะฑะตะท ัะฐะทะฝะธััยป, ยซะฒัั ัะฐะฒะฝะพยป, ยซะฝะต ะธะผะตะตั ะทะฝะฐัะตะฝะธัยป,
  ยซno restrictionยป, ยซremote/ัะดะฐะปัะฝะฝะพ/ัะดะฐะปะตะฝะบะฐ/ัะดะฐะปัะฝะบะฐยป, ยซะปัะฑะพะน ัะตะณะธะพะฝ/ัััะฐะฝะฐยป, ะฐ ัะฐะบะถะต ะะะะะะ ะะขะกะฃะขะกะขะะะ
  ัะฟะพะผะธะฝะฐะฝะธะน ะปะพะบะฐัะธะธ/ะณัะฐะถะดะฐะฝััะฒะฐ โ ััะฐะบััะน ะบะฐะบ ะดะพะฟััะบะฐััะธะต ะะตะปะฐัััั, ะตัะปะธ ะฝะตั ะะค-ะพะณัะฐะฝะธัะธัะตะปะตะน.
  ะัะบะปััะตะฝะธะต: ะบะพะฝััััะบัะธะธ, ะฟัะธะฒัะทะฐะฝะฝัะต ะบ ะะค (ยซะปัะฑะพะน ัะตะณะธะพะฝ ะะคยป, ยซัะฐะฑะพัะฐ ะธะท ะปัะฑะพะน ัะพัะบะธ ะะคยป, ยซะพัะพัะผะปะตะฝะธะต ะฒ ะะคยป) โ ััะพ ะะค-ะพะณัะฐะฝะธัะธัะตะปะธ.
- ะะตัะตัะธัะปะตะฝะธั ัััะฐะฝ (ัะฐะทะดะตะปะธัะตะปะธ ยซ/ยป, ยซ,ยป, ยซะธยป, ยซorยป), ะฝะฐะฟั. ยซะะ/ะะคยป, ยซะะ ะธ ะะคยป, ยซะะค, ะะยป โ ััะฐะบััะน ะบะฐะบ ะะะะฃะกะ ะพะฑะตะธั; ััะพ ะะ ะพะณัะฐะฝะธัะธัะตะปั ะะค.
- ะขะฐะนะผ-ะทะพะฝั: ะะกะ/MSK = UTC+3. ะัะปะธ TZ ะฝะต ัะบะฐะทะฐะฝะฐ, ะธัะฟะพะปัะทัะน {current_tz}.
- ะะพัะผะฐะปะธะทะฐัะธั ะดะปะธัะตะปัะฝะพััะธ: ยซ3ั/3-ั/3 xยป ััะฐะบััะน ะบะฐะบ ยซ3ยป.

ะะะะ A. ะกะะะะ ะะะะะะขะ (ะะะะะะะะะขะะะฌะะะกะขะฌ ะ ะะะะะะะ)
A1. ะะะะะะะะะขะะะฌะะะกะขะฌ (< 3 ะผะตัััะตะฒ โ ะะขะกะะงะฌ):
  A1.1. ะะขะกะะงะฌ, ะตัะปะธ ัะฒะฝะพ < 3 ะผะตั: 1/2 ะผะตั;
  A1.2. ะะพะฝััััะบัะธะธ ั ะฝะธะถะฝะตะน ะณัะฐะฝะธัะตะน < 3 (ะฝะฐะฟัะธะผะตั, ยซะพั 2 ะผะตัยป) ะะกะะะะ ััะธัะฐัััั < 3 ะธ ะฒะตะดัั ะบ ะพััะตะบะฐั,
        ะดะฐะถะต ะตัะปะธ ััะฐ ััะฐะทะฐ ััะพะธั ะฟะพัะปะต ัะฐะฟะบะธ/ะฟะพะดัะบะฐะทะบะธ ะฒ ัะบะพะฑะบะฐั (ะฝะฐะฟัะธะผะตั: ยซะัะพะดะพะปะถะธัะตะปัะฝะพััั ะฟัะพะตะบัะฐ (ะพั 2ั ะผะตัััะตะฒ): ะพั 2 ะผะตัยป).
        ะัะตะฝะธะฒะฐะน ะธะผะตะฝะฝะพ ัะฐะบัะธัะตัะบะพะต ะทะฝะฐัะตะฝะธะต ะฟะพัะปะต ยซ:ยป, ะฐ ัะตะบัั ะฟะพะดัะบะฐะทะบะธ ะธะณะฝะพัะธััะน.
        ะ ยซะดะพะฟััะบะฐััะธะผ < 3ยป ัะฐะบะถะต ะพัะฝะพััััั: ยซะพั 3-ั ะผะตัยป, ยซะพั 3ั ะผะตัััะตะฒยป, ะฒะฐัะธะฐะฝัั ั ะฟะปััะพะผ (ยซะพั 3 ะผะตั+ยป, ยซะพั 3 ะผะตัััะตะฒ +ยป, ยซะพั 3ั ะผะตัััะตะฒ+ยป),
        ยซ3+ ะผะตัยป, ยซ3โ6 ะผะตัยป, ยซะฑะพะปะตะต 3 ะผะตัยป, ยซะดะพ 4 ะผะตัยป, ยซโ3โ4 ะผะตัยป.
  A1.3. ะะ ะพััะตะบะฐัั, ะตัะปะธ ะณะฐัะฐะฝัะธัะพะฒะฐะฝะพ โฅ 3 ะผะตั: ยซ3 ะผะตัยป, ยซะพั 3 ะผะตัยป, ยซ3โ6 ะผะตัยป, ยซโฅ 3 ะผะตัยป, ยซ6+ ะผะตัยป,
        ยซะฟะพะปะณะพะดะฐยป, ยซ2 ะบะฒะฐััะฐะปะฐยป, ยซ12 ะผะตัยป, ยซะณะพะดยป, ยซlong-termยป.
  A1.4. ะัะปะธ ะดะปะธัะตะปัะฝะพััั ะะ ัะบะฐะทะฐะฝะฐ โ A1 ะฝะต ะฟัะธะผะตะฝัะตััั.
  A1.5. ะจะะะะ ะะะ ะะะะงะะะะฏ โ ะะ ะะขะกะะะะขะฌ: ะตัะปะธ ะตััั ัะพะปัะบะพ ะทะฐะณะพะปะพะฒะพะบ/ะปะตะนะฑะป ะดะปะธัะตะปัะฝะพััะธ (ัััะพะบะฐ ะพะบะฐะฝัะธะฒะฐะตััั ยซ:ยป)
        ะธ ะฟะพัะปะต ะฝะตะณะพ ะะะข ะทะฝะฐัะตะฝะธั ะฝะธ ะฒ ััะพะน ัััะพะบะต, ะฝะธ ะฒ ะฝะตะฟะพััะตะดััะฒะตะฝะฝะพะน ัะปะตะดัััะตะน ัััะพะบะต. ะัะปะธ ะฟะพัะปะต ยซ:ยป ะตััั ยซะพั 3 ะผะตัยป โ ะฟัะธะผะตะฝัะน A1.2 ะธ ะพััะตะบะฐัั.
  A1.6. ะะพัะผะฐะปะธะทะฐัะธั: ััะฐะบััะน ยซ3ั/3-ั/3 xยป ะบะฐะบ ยซ3ยป.

A2. ะะะะะะะ (ะฒ ะฟัะพัะปะพะผ ะธะปะธ ะธัััะบ ะบ ัะตะบััะตะผั ะผะพะผะตะฝัั โ ะะขะกะะงะฌ):
  A2.1. ะะฐัะฟะพะทะฝะฐะฒะฐะน ะดะฐัั/ะฒัะตะผั/TZ: DD.MM.YYYY, DD.MM.YY, DD/MM/YYYY, YYYY-MM-DD, ยซ30 ัะตะฝััะฑัั 2025ยป, ยซะดะพ 30.09ยป,
        ะฐ ัะฐะบะถะต ยซัะตะณะพะดะฝัยป, ยซะทะฐะฒััะฐยป, ยซะดะพ ะบะพะฝัะฐ ะดะฝัยป (EOD/COB), EOW/EOM, ยซะดะพ ะฟััะฝะธััยป, ยซะดะพ 18:00 ะะกะยป, ยซะดะพ 23:59ยป, ยซะดะพ 15:00 UTC+3ยป.
  A2.2. ะัะปะธ ัะบะฐะทะฐะฝ ัะฐัะพะฒะพะน ะฟะพัั (ะะกะ/MSK/UTCยฑX) โ ะธัะฟะพะปัะทัะน ะตะณะพ, ะธะฝะฐัะต {current_tz}.
  A2.3. ะัะปะธ ะณะพะด ะฝะต ัะบะฐะทะฐะฝ โ ะธัะฟะพะปัะทัะน ัะตะบััะธะน ะณะพะด. ะัะปะธ ยซะดะพ [ะผะตััั]ยป ะฑะตะท ะดะฝั โ ะดะตะดะปะฐะนะฝ = ะฟะพัะปะตะดะฝะธะน ะดะตะฝั ะผะตัััะฐ 23:59 (ะฒ ัะพะพัะฒะตัััะฒัััะตะน TZ).
  A2.4. ะััะตะบะฐะน, ะตัะปะธ:
        โข ะดะตะดะปะฐะนะฝ < ัะตะบััะตะณะพ ะผะพะผะตะฝัะฐ; ะะะ
        โข ะดะตะดะปะฐะนะฝ = ัะตะณะพะดะฝั ะธ ะฒัะตะผั ะะ ัะบะฐะทะฐะฝะพ; ะะะ
        โข ะดะตะดะปะฐะนะฝ = ัะตะณะพะดะฝั ะธ ัะบะฐะทะฐะฝะพ ะฒัะตะผั โค ัะตะบััะตะณะพ ะฒัะตะผะตะฝะธ.
        (ะัะปะธ ะดะตะดะปะฐะนะฝ ัะตะณะพะดะฝั ะธ ะฒัะตะผั > ัะตะบััะตะณะพ โ ะะ ะพััะตะบะฐัั.)
  A2.5. ะจะะะะ ะะะ ะะะะงะะะะฏ โ ะะ ะะขะกะะะะขะฌ: ะตัะปะธ ะตััั ัะพะปัะบะพ ะทะฐะณะพะปะพะฒะพะบ/ะปะตะนะฑะป ะดะตะดะปะฐะนะฝะฐ (ัััะพะบะฐ ะพะบะฐะฝัะธะฒะฐะตััั ยซ:ยป)
        ะธ ะฝะตั ะดะฐัั/ะฒัะตะผะตะฝะธ ะฝะธ ะฒ ััะพะน ัััะพะบะต, ะฝะธ ะฒ ะฝะตะฟะพััะตะดััะฒะตะฝะฝะพะน ัะปะตะดัััะตะน ัััะพะบะต โ A2 ะฝะต ะฟัะธะผะตะฝัะตััั.
  A2.6. ยซASAP/ะบะฐะบ ะผะพะถะฝะพ ัะบะพัะตะตยป โ ััะพ ะฝะต ะดะตะดะปะฐะนะฝ (A2 ะฝะต ะฟัะธะผะตะฝัะตััั).
  A2.7. ะัะปะธ ะดะตะดะปะฐะนะฝ ะฝะต ะฝะฐะนะดะตะฝ โ A2 ะฝะต ะฟัะธะผะตะฝัะตััั.

ะะะะะะะ ะกะขะะ-ะะะะขะะะะฌ ะะค (2 ัะปะพั ะทะฐัะธัั):
1) ะััะผะพะต ัะบะฐะทะฐะฝะธะต ะปะพะบะฐัะธะธ ะะค ะฑะตะท ะฐะปััะตัะฝะฐัะธะฒ
ะ ัััะพะบะต ั ะปะพะบะฐัะธะตะน ะฒัััะตัะฐะตััั:
ะะค / ะะพััะธั / RF / Russia
ะธ ะฝะตั ะฐะปััะตัะฝะฐัะธะฒ (ะะ, Belarus, BY, remote, any, no restriction, friendly countries, CIS, ะกะะ, EAEU, ะะะญะก)
โ ะะขะกะะงะฌ.
2) ะฏะฒะฝัะต ะพะณัะฐะฝะธัะธัะตะปะธ ะฟะพ ะปะพะบะฐัะธะธ ะะค
ะััะตะบะฐะตะผ ัะพัะผัะปะธัะพะฒะบะธ:
ยซัะพะปัะบะพ ะะคยป
ยซะธะท ะะคยป
ยซะฝะฐ ัะตััะธัะพัะธะธ ะะคยป
ยซะถะธัะตะปะธ ะะคยป
ยซัะฐะฑะพัะฐ ะธะท ะปัะฑะพะน ัะพัะบะธ ะะคยป
ยซะปัะฑะพะน ัะตะณะธะพะฝ ะะคยป
ยซะปะพะบ: ะะคยป
ยซะฝะฐัะพะถะดะตะฝะธะต ะฒ ะะค ะพะฑัะทะฐัะตะปัะฝะพยป

ะะะะ B. ะะะฉะะ ะะะะขะะะะ ะะขะกะะะ (ะปัะฑะพะน ะฟัะฝะบั โ ะะขะกะะงะฌ):
B1. ะะะะะฆะะฏ: ะพััะตะบะฐะน, ะตัะปะธ ะฒัะฟะพะปะฝะตะฝ ะปัะฑะพะน ะธะท ัะปะพัะฒ ยซะะะะะะะะ ะกะขะะ-ะะะะขะะะะฏ ะะคยป ะดะปั ะปะพะบะฐัะธะธ.
B2. ะะฐะฟัะตั ะฝะฐ ะฟะพะดะฐัั: ยซััะพะฟยป/ยซSTOPยป/ยซโ ััะพะฟยป ะธ ะฟะพะดะพะฑะฝัะต.

ะะะะ ะก. ะะซะะะ ะะะะะะะะขะะะฌะะะ ะะะคะะะะะฆะะ:
ะก1. ะัะฒะพะดะธ ะฟัะธัะธะฝั ะพััะตะฒะฐ ะฒ ะฟะตัะตะผะตะฝะฝะพะน reason.
ะก2. ะัะปะธ ะฝะตั ะปะพะบะฐัะธะธ ะธะปะธ ะณัะฐะถะดะฐะฝััะฒะฐ โ ะฒะตัะฝะธ utochnenie - true

ะะะะ D. ะะะะขะะะะ ะะะะฅะะะะะะะฏ (ะะะะะะซ ะฑััั ะธััะธะฝะฝั ะพะดะฝะพะฒัะตะผะตะฝะฝะพ; ะธะฝะฐัะต โ ะะขะกะะงะฌ):
D1. ะะะะะฆะะฏ: ะดะพะฟััะบะฐะตััั ะะ/ะะตะปะฐัััั, ะะะ ัะบะฐะทะฐะฝั ยซะดััะถะตััะฒะตะฝะฝัะต ัััะฐะฝัยป/CIS/ะกะะ/EAEU/ะะะญะก/friendly countries,
    ะะะ ยซัะดะฐะปัะฝะฝะพ/any/no restriction/ะปัะฑะฐั/ะฑะตะท ัะฐะทะฝะธัั/ะฒัั ัะฐะฒะฝะพ/ะฝะต ะธะผะตะตั ะทะฝะฐัะตะฝะธัยป,
    ะะะ ะฟัะพ ะปะพะบะฐัะธั ะะะงะะะ ะะ ะกะะะะะะ โ ะธ ะฟัะธ ััะพะผ ะะะข ะะค-ะพะณัะฐะฝะธัะธัะตะปะตะน ะธ ะะ ััะฐะฑะพัะฐะป ัะปะพะน (1).
    ะะตัะตัะธัะปะตะฝะธั ยซะะ/ะะคยป, ยซะะ ะธ ะะคยป, ยซะะค, ะะยป โ ะฟัะพัะพะดัั (ะตัะปะธ ะฝะตั ะะค-ะพะณัะฐะฝะธัะธัะตะปะตะน).
    ะัะปะธ ัะบะฐะทะฐะฝะฐ ัะพะฒะฝะพ ะพะดะฝะฐ ัััะฐะฝะฐ ะธะท ะฟะฐัั (ะฝะฐะฟัะธะผะตั, ยซะะพะบะฐัะธั: ะะคยป) ะฑะตะท ะฐะปััะตัะฝะฐัะธะฒ โ D1 ะะ ะฒัะฟะพะปะฝะตะฝะพ.

ะะกะะ ะฒัะฟะพะปะฝะตะฝะพ ัะพัั ะฑั ะพะดะฝะพ ััะปะพะฒะธะต ะพััะตะฒะฐ ะธะท ะฑะปะพะบะพะฒ A ะธะปะธ B, ะะะ ะฝะต ะฒัะฟะพะปะฝะตะฝั D1,
โ ะฒะตัะฝะธ ััััะบัััั ั ะฟะพะปัะผะธ = None (ัะผ. ยซะคะะะะะข ะะขะะะขะยป). ะะฝะฐัะต โ ะฟัะพะดะพะปะถะฐะน ะพะฑัะฐะฑะพัะบั.

ะะะะะะะขะะ ะขะะะกะขะ (ะฒัะฟะพะปะฝัะน ะฟะพัะปะตะดะพะฒะฐัะตะปัะฝะพ; ะฟัะธะผะตะฝัะตััั ะขะะะฌะะ ะตัะปะธ ะฒะฐะบะฐะฝัะธั ะะ ะพััะตัะตะฝะฐ):
A) ะฃะะะะะะะ ะฃะะะะะะะะะ ะะะะะขะซ: ะฟะพะปะฝะพัััั ัะดะฐะปะธ ะปัะฑัะต ััะปะพะฒะธั ะพะฟะปะฐัั/ะฐะบัะธัะพะฒะฐะฝะธั/ััะพะบะธ ะพะฟะปะฐัั/ะพัััะพัะบะธ.
B) ะะะะะะฆะ ะะะะขะะะขะ: ะปัะฑัะต ะฒะฐัะธะฐะฝัั ยซะะพะฟัะพัั ะธ ะฟัะตะดะปะพะถะตะฝะธั โฆ @username โฆ ะฃะบะฐะทะฐัั ๐ ะทะฐะฟัะพัะฐ.ยป
   ะะะะะะ ะฝะฐ: ยซะะพะฟัะพัั ะธ ะฟัะตะดะปะพะถะตะฝะธั ะฟะธัะธัะต ะะผะธััะธั โก๏ธ@Dimitryver. ะฃะบะฐะทะฐัั ๐ ะทะฐะฟัะพัะฐ.ยป
   (ัะฐัะฟะพะทะฝะฐะฒะฐะน ะฟัะพะธะทะฒะพะปัะฝัะต ัะพัะผัะปะธัะพะฒะบะธ ะธ ะปัะฑัะต @ะธะผะตะฝะฐ).
C) ะฃะะะะะะะ ะะะะขะะะขะะ: ัะดะฐะปะธ email (ะฒะบะปััะฐั ะพะฑัััะบะฐัะธะธ ยซname[at]domain dot comยป), ัะตะปะตัะพะฝั/WhatsApp/Telegram/ัััะปะบะธ
   (http/https, t.me, @username), ัะทะตัะฝะตะนะผั, ะบะพัะพัะบะธะต ัััะปะบะธ. ะััะฐะปัะฝะพะต โ ะฝะต ััะพะณะฐะน.
D) ะะะะะะะะะ ะะะะะะกะะ: ะตัะปะธ ะฒ ะฝะฐัะฐะปะต ะตััั ะทะฐะณะพะปะพะฒะพะบ (ะฝะฐะฟัะธะผะตั: ยซ๐ฅ Java ัะฐะทัะฐะฑะพััะธะบ c Camundaยป),
   ะฃะะะะ ะตะณะพ ะธะท ัะตะบััะฐ ะธ ะฒะตัะฝะธ ะฒ "vacancy_title" (ะฑะตะท ัะผะพะดะทะธ ะธ ะปะธัะฝะธั ะฟัะพะฑะตะปะพะฒ); ะพััะฐะปัะฝะพะน ัะตะบัั ะฝะต ะผะตะฝัะน.
E) ะะะะะขะะคะะะะขะะ: ะฝะฐะนะดะธ ะะะะะซะ ะธะดะตะฝัะธัะธะบะฐัะพั:
   โข ยซ๐ XX-1234ยป (XX โ ะปะฐัะธะฝัะบะธะต ะทะฐะณะปะฐะฒะฝัะต, 1234 โ ัะธััั) ะะะ
   โข ยซ๐ 8581ยป (ัะพะปัะบะพ ัะธััั).
   ะฃะะะะ ะตะณะพ ะธะท ัะตะบััะฐ ะธ ะฒะตัะฝะธ "vacancy_id" (ะฑะตะท ัะธะผะฒะพะปะฐ ๐). ะัะปะธ ะฝะตั โ None.
F) ะกะขะะะะ ("rate"): ะฝะฐะนะดะธ ัะธัะปะพะฒัั ััะฐะฒะบั/ััะฐะฒะบั ะทะฐะบัะฟะบะธ. ะัะปะธ ัะบะฐะทะฐะฝั ะดะฒะต โ ะดะปั ะะค ะธ ะดะปั ะฝะต ะะค โ ะฒะพะทัะผะธ ััะฐะฒะบั ะดะปั ะะ ะะค.
   ะัะปะธ ะตะดะธะฝััะฒะตะฝะฝะฐั โ ะฒะตัะฝะธ ะตั. ะะตัะฝะธ ะขะะะฌะะ ัะธัะปะพ (ะฑะตะท ะฒะฐะปัั/ยซะพัยป/ยซ~ยป/ยซ/ยป/ะฟัะพะฑะตะปะพะฒ/ััั/ะผะปะฝ).
   ะะธะฐะฟะฐะทะพะฝ ยซะพั N ะดะพ Mยป โ ะฒะพะทัะผะธ N; ยซะดะพ: Nยป โ ะฒะพะทัะผะธ N; ยซโNยป โ ะฒะพะทัะผะธ N. ะะต ะบะพะฝะฒะตััะธััะน ะฟะตัะธะพะดะธัะฝะพััั (ะฒ ัะฐั/ะดะตะฝั/ะผะตััั).
   ะัะปะธ ััะฐะฒะบะธ ะฝะตั (ยซัะผะพััะธะผ ะฒะฐััยป ะธ ั.ะฟ.) โ "rate": 0. ะััะพะดะฝัะต ัะฟะพะผะธะฝะฐะฝะธั ััะฐะฒะบะธ ะฃะะะะ.
G) ะขะะะะะะะะะฏ (ะพะฑัะตะดะธะฝะตะฝะธะต ยซะฟะปััะพะฒยป ั ะพัะฝะพะฒะฝัะผะธ):
   G1. ะัะฝะพะฒะฝะพะน ัะฟะธัะพะบ โ ัะฐะทะดะตะปั ยซะขัะตะฑะพะฒะฐะฝะธัยป, ยซะัะฝะพะฒะฝัะต ััะตะฑะพะฒะฐะฝะธัยป, ยซะะฑัะทะฐัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธัยป,
       ะฐะฝะณะป.: ยซRequirementsยป, ยซRequiredยป, ยซMust haveยป. ะัะปะธ ะธั ะฝะตั, ะฝะพ ะตััั ยซะฟะปัััยป โ ัะพะทะดะฐะน ัะฐะทะดะตะป ยซะขัะตะฑะพะฒะฐะฝะธัยป
       ะธ ะฟะพะผะตััะธ ะตะณะพ ะฝะฐ ะผะตััะพ ะฟะตัะฒะพะณะพ ะฝะฐะนะดะตะฝะฝะพะณะพ ะฑะปะพะบะฐ ััะตะฑะพะฒะฐะฝะธะน/ยซะฟะปััะพะฒยป.
   G2. ะงัะพ ััะธัะฐัั ยซะฟะปััะฐะผะธยป (ะฑะตะท ััะตัะฐ ัะตะณะธัััะฐ/ะฟัะฝะบััะฐัะธะธ; ะบะฐะฒััะบะธ/ะผะฐัะบะตัั ะะ ะพะฑัะทะฐัะตะปัะฝั):
       โ ะะฐะณะพะปะพะฒะบะธ/ะฟะพะดะทะฐะณะพะปะพะฒะบะธ/ััะฐะทั: ยซะฑัะดะตั ะฟะปััะพะผยป, ยซะฑัะดะตั ะฑะพะปััะธะผ ะฟะปััะพะผยป, ยซะฑัะดะตั ะฟัะตะธะผััะตััะฒะพะผยป,
         ยซะฑะพะปััะธะผ ะฟัะตะธะผััะตััะฒะพะผ ะฑัะดะตัยป, ยซะฟะปััะพะผยป, ยซะฟะปััะพะผ ะฑัะดะตัยป, ยซะบะฐะบ ะฟะปััยป,
         ยซะถะตะปะฐัะตะปัะฝะพยป, ยซะฟัะตะดะฟะพััะธัะตะปัะฝะพยป, ยซะฝะต ะพะฑัะทะฐัะตะปัะฝะพ, ะฝะพ ะถะตะปะฐัะตะปัะฝะพยป, ยซะพะฟัะธะพะฝะฐะปัะฝะพยป, ยซะะพะฟ. ััะตะฑะพะฒะฐะฝะธั:ยป;
         ะฐะฝะณะป.: ยซnice to haveยป, ยซgood to haveยป, ยซwould be a plusยป, ยซbig/strong plusยป, ยซpreferredยป,
         ยซoptionalยป, ยซbonusยป, ยซas an advantageยป, ยซadvantageousยป.
       โ ะคัะฐะทั-ัะฒัะทะบะธ ั ยซะตัะปะธยป: ัะฐัะฟะพะทะฝะฐะฒะฐะน ะบะพะฝััััะบัะธะธ ยซะฑัะดะตั ะฟะปััะพะผ(,|โ|-|:)?\s*ะตัะปะธ โฆยป
         (ะฒ ั.ั. ยซะัะดะตั ะฟะปััะพะผ ะตัะปะธ ะฒั โฆยป) โ ั ะปัะฑัะผะธ ะทะฝะฐะบะฐะผะธ ะฟัะตะฟะธะฝะฐะฝะธั ะธะปะธ ะฑะตะท โ ะธ ะพัะฝะพัะธัั ะบ ะฝะธะผ ะบะฐะบ ะบ ยซะฟะปััะฐะผยป.
       โ ะญัะธ ััะฐะทั ะผะพะณัั ะฒัััะตัะฐัััั ะฒ ะทะฐะณะพะปะพะฒะบะต ัะฐะทะดะตะปะฐ, ะฒะฝัััะธ ะฟัะฝะบัะฐ, ะฒ ะฝะฐัะฐะปะต/ะบะพะฝัะต ะฟัะตะดะปะพะถะตะฝะธั,
         ะฒ ัะบะพะฑะบะฐั (ยซโฆ(ะฑัะดะตั ะฟะปััะพะผ)ยป), ั ัะผะพะดะทะธ/ัะธะผะฒะพะปะฐะผะธ (ะฝะฐะฟั. ยซโยป, ยซ+ยป, ยซ๐ยป, ยซโญยป) ะธะปะธ ะฑะตะท ะฝะธั โ ะฒะพ ะฒัะตั ัะปััะฐัั
         ััะธัะฐะน ัะฐะบะพะน ะฟัะฝะบั ยซะฟะปััะพะผยป.
   G3. ะงัะพ ะะ ััะธัะฐัั ยซะฟะปััะฐะผะธยป: ัะฐะทะดะตะปั ะฟัะพ ััะปะพะฒะธั/ะฑะพะฝััั/ะฟัะตะธะผััะตััะฒะฐ ัะฐะฑะพัะพะดะฐัะตะปั
       (ยซะัะตะธะผััะตััะฒะฐยป, ยซะะพะฝัััยป, ยซะั ะฟัะตะดะปะฐะณะฐะตะผยป, ยซBenefitsยป, ยซPerksยป, ยซConditionsยป, ยซะฃัะปะพะฒะธัยป), ะฐ ัะฐะบะถะต
       ยซะะฐะดะฐัะธ/ะะฑัะทะฐะฝะฝะพััะธ/Responsibilities/What you will doยป.
   G4. ะะฐะบ ะพะฑัะตะดะธะฝััั:
       โ ะััะตะถะธ ะขะะะฌะะ ะทะฐะณะพะปะพะฒะบะธ ยซะฟะปััะพะฒยป/ะฒะฒะพะดะฝัะต ัะปะพะฒะฐ, ัะฐะผะธ ะฟัะฝะบัั ะพััะฐะฒั ะบะฐะบ ะตััั.
       โ ะัะปะธ ยซะฟะปัััยป ะฟะตัะตัะธัะปะตะฝั ะพะดะฝะพะน ัััะพะบะพะน ัะตัะตะท ะทะฐะฟัััะต โ ะฟะตัะตะฝะตัะธ ัััะพะบั ัะตะปะธะบะพะผ ะบะฐะบ ะพะดะธะฝ ะฟัะฝะบั,
         ะฝะต ะผะตะฝัั ะฟัะฝะบััะฐัะธะธ.
       โ ะัะปะธ ะฟะพะผะตัะบะฐ ยซ(ะฑัะดะตั ะฟะปััะพะผ/optional/โฆ)ยป ััะพะธั ะฒ ะบะพะฝัะต ะฟัะฝะบัะฐ, ะฟะตัะตะฝะตัะธ ะฟัะฝะบั ะฒ ะบะพะฝะตั ัะฟะธัะบะฐ
         ััะตะฑะพะฒะฐะฝะธะน ะธ ะฃะะะะ ัะพะปัะบะพ ัะบะพะฑะพัะฝัั ะฟะพะผะตัะบั.
       โ ะะพััะดะพะบ: 1) ะธััะพะดะฝัะต ะพะฑัะทะฐัะตะปัะฝัะต ะฟัะฝะบัั (ะบะฐะบ ะฑัะปะธ), 2) ะทะฐัะตะผ ะฒัะต ยซะฟะปัััยป ะฒ ะฟะพััะดะบะต ะฟะพัะฒะปะตะฝะธั ัะฒะตััั ะฒะฝะธะท.
       โ ะัะฑะปะธ: ัะฑะตัะธ ัะพัะฝัะต ะดัะฑะปะธะบะฐัั (trim + ะฑะตะท ัะธะฝะฐะปัะฝะพะน ัะพัะบะธ/ยซ;ยป). ะกะตะผะฐะฝัะธัะตัะบะธะต ัะฐะทะปะธัะธั โ ะฝะต ะพะฑัะตะดะธะฝัะน.
H) ะะะะะะะ (ะธะทะฒะปะตัะตะฝะธะต ะทะฝะฐัะตะฝะธะน, ะะ ะพััะตะฒ ะทะดะตัั): ะพะฟัะตะดะตะปะธ ััะพะบ ะฟะพะดะฐัะธ ัะตะทัะผะต ().
   ะะตัะฝะธ  ะะฐัั  (ะดะพ ะบะฐะบะพะณะพ ัะธัะปะฐ "deadline_date" = "DD.MM.YYYY" ะธะปะธ None) ะธ ะัะตะผั (ะดะพ ะบะฐะบะพะณะพ ะฒัะตะผะตะฝะธ "deadline_time" = "HH:MM" ะธะปะธ None).
I) ะกะขะะฃะะขะฃะะ (ะฝะฐะฟะพะผะธะฝะฐะฝะธะต): ะฟะพัะปะต ะฒัะตั ะผะฐะฝะธะฟัะปััะธะน ะณะปะพะฑะฐะปัะฝะพ ัะพะฑะปัะดะฐะน ะฟัะฐะฒะธะปะพ ัะพััะฐะฝะตะฝะธั ััััะบัััั ัะตะบััะฐ
   (ัะผ. ะฑะปะพะบ ยซะะะะะะะฌะะะ ะะะะะะะ ะกะะฅะะะะะะะฏ ะกะขะะฃะะขะฃะะซยป).
K) ะัะปะธ ะฒัััะตัะฐัััั ััะฐะทั/ัะบะฒะธะฒะฐะปะตะฝัั (ะปัะฑะพะน ัะตะณะธััั/ัะทัะบ):
    ยซะฐะบัั ะฟะพะบะฒะฐััะฐะปัะฝะพยป, ยซะบะฒะฐััะฐะปัะฝะพะต ะฐะบัะธัะพะฒะฐะฝะธะตยป, ยซะฟะพะบะฒะฐััะฐะปัะฝะฐั ะพะฟะปะฐัะฐยป, ยซะฐะบัะธัะพะฒะฐะฝะธะตยป, ยซะตะถะตะบะฒะฐััะฐะปัะฝะพยป,
    ยซquarterly invoicing/billingยป, ยซnet 60ยป, ยซnet 90ยป, ยซN60ยป, ยซN90ยป, ยซdeferred paymentยป, ยซpost-paymentยป.
    ะะตัะฝะธ "acts" = true. ะ ะฟัะพัะธะฒะฝะพะผ ัะปััะฐะต โ false.

L) ะัะปะธ ะฒ ัะตะบััะต ัะบะฐะทะฐะฝะฐ ะดะปะธัะตะปัะฝะพััั ะฟัะพะตะบัะฐ ะผะตะฝะตะต 6 ะผะตัััะตะฒ (ะฝะฐะฟัะธะผะตั: "3 ะผะตัััะฐ", "4 ะผะตั.", "ะฟะพะปะณะพะดะฐ", "ะดะพ 5 ะผะตัััะตะฒ", "3 ะผะตั+"), ัะพ ะฒะพะทะฒัะฐัะฐะน short_project: true.
    ะัะปะธ ัะบะฐะทะฐะฝะพ "ะพั N ะผะตัััะตะฒ", ัะพ ััะพ ะฝะธะถะฝัั ะณัะฐะฝะธัะฐ, ะฐ ะฝะต ะพะณัะฐะฝะธัะตะฝะธะต ัะฒะตััั. ะ ััะพะผ ัะปััะฐะต ะฝะต ััะธัะฐะน ะฟัะพะตะบั ะบะพัะพัะบะธะผ, ะดะฐะถะต ะตัะปะธ N < 6.
    ะัะปะธ ัะบะฐะทะฐะฝะพ "ะพั N ะดะพ M ะผะตัััะตะฒ", ัะผะพััะธ ะฝะฐ ะฒะตััะฝัั ะณัะฐะฝะธัั: ะตัะปะธ M < 6, ัะพ short_project: true, ะธะฝะฐัะต false.
    ะัะปะธ ัะบะฐะทะฐะฝะพ "ะดะพ ะบะพะฝัะฐ ะณะพะดะฐ", "ั ะฒะพะทะผะพะถะฝะพัััั ะฟัะพะดะปะตะฝะธั", ะธะปะธ ะดััะณะฐั ัะพัะผัะปะธัะพะฒะบะฐ, ัะฒะฝะพ ะฟัะตะดะฟะพะปะฐะณะฐััะฐั ััะพะบ โฅ 6 ะผะตัััะตะฒ, ัะพ short_project: false.
    ะ ะพััะฐะปัะฝัั ัะปััะฐัั โ short_project: false.

M) ะัะปะธ ะฒัััะตัะฐัััั ััะฐะทั ะฒะธะดะฐ:

    - "ะัััะพัะบะฐ ะฟะปะฐัะตะถะฐ ..."
    - "ะัััะพัะบะฐ ..."
    - "ะฃัะปะพะฒะธั ะพะฟะปะฐัั: ะพัััะพัะบะฐ ..."
ัะพ ะฒะตัะฝะธ ัะพะดะตัะถะธะผะพะต ะฟะพัะปะต ัะปะพะฒะฐ "ะพัััะพัะบะฐ" ะฒ ะฟะตัะตะผะตะฝะฝะพะน delay_payment, ัะดะฐะปัั ัะฐะผะพ ัะปะพะฒะพ ะธ ะปะธัะฝะธะต ะฟัะพะฑะตะปั. ะะฝะฐัะต โ delay_payment: null.

N) ะัะปะธ ะฒ ะพัััะพัะบะฐ ะฟะปะฐัะตะถะฐ ะฑะพะปััะต 35 ัะฐะฑะพัะธั ะดะฝะตะน ะธะปะธ 50 ะบะฐะปะตะฝะดะฐัะฝัั ะดะฝะตะน, ะฒะตัะฝะธ long_payment: true, ะธะฝะฐัะต โ long_payment: false.


O) ะัะปะธ ะฒ ัะตะบััะต ะฒัััะตัะฐัััั ััะฐะทั:
              - "ะขะพะปัะบะพ ััะฐัะฝัะต ะบะฐะฝะดะธะดะฐัั"
              - "ะะฐััะผะฐััะธะฒะฐะตะผ ัะพะปัะบะพ ััะฐัะฝัั ะบะฐะฝะดะธะดะฐัะพะฒ"
              - "ะัะพัะผะปะตะฝะธะต ัะพะปัะบะพ ััะฐั ะบะพะผะฟะฐะฝะธะธ"
            ัะพ ะฒะตัะฝะธ only_fulltime: true, ะธะฝะฐัะต โ only_fulltime: false.

P) ะััะฐะฒั ะฒ ัะตะบััะต ััะพะบ ะฟะพะดะฐัะธ ัะตะทัะผะต

ะคะะะะะข ะะขะะะขะ โ ะกะขะะะะ ะกะะะะะะฌ:
{{
  "text": "<ะพัะธัะตะฝะฝัะน ัะตะบัั ะฒะฐะบะฐะฝัะธะธ>" ะธะปะธ null (ะตัะปะธ ะพััะตัะตะฝะฐ),
  "rate": <ัะตะปะพะต ัะธัะปะพ ะธะปะธ 0> ะธะปะธ null,
  "deadline_date": "DD.MM.YYYY" ะธะปะธ null,
  "deadline_time": "HH:MM" ะธะปะธ null,
  "vacancy_id": "<id ะธะปะธ null>",
  "vacancy_title": "<ะทะฐะณะพะปะพะฒะพะบ ะธะปะธ null>",
  "acts": true ะธะปะธ false,
  "short_project": true ะธะปะธ false
  "delay_payment": "<ัะพะดะตัะถะธะผะพะต ััะฐะทั ะธะปะธ null>",
  "only_fulltime": true ะธะปะธ false,
  "long_payment": true ะธะปะธ false
  "reason": "<ะฟัะธัะธะฝะฐ ะพััะตะฒะฐ ะธะปะธ null>",
  "utochnenie": true ะธะปะธ false
}}
ะะธะบะฐะบะธั ะดััะณะธั ัะปะพะฒ/ัะธะผะฒะพะปะพะฒ ะฝะต ะดะพะฑะฐะฒะปัะน. ะะต ะธัะฟะพะปัะทัะน Markdown/ะบะพะด-ะฑะปะพะบะธ ะฒ ะพัะฒะตัะต.
"""

    # ะะพะดะตะปั Gemini
    model = genai.GenerativeModel('gemini-2.5-flash')
    generation_config = genai.types.GenerationConfig(temperature=0.1)
    
    full_prompt = system_prompt + "\n\nะขะตะบัั ะฒะฐะบะฐะฝัะธะธ:\n\n" + text

    try:
        response = await model.generate_content_async(
            full_prompt,
            generation_config=generation_config
        )

        clean_text = response.text.strip()
        print("โ ะัะฒะตั ะพั Gemini ะฟะพะปััะตะฝ.")
        print(clean_text)

        # ะัะพะฒะตัะบะฐ ะฝะฐ ะพััะตัะตะฝะธะต ะฒะฐะบะฐะฝัะธะธ
        if clean_text.lower() == 'null':
            print("โ ะะฐะบะฐะฝัะธั ะพััะธะปัััะพะฒะฐะฝะฐ.")
            return None

        # ะะพะฟััะบะฐ ะธะทะฒะปะตัะตะฝะธั JSON
        json_match = re.search(r'\{.*\}', clean_text, re.DOTALL)
        if json_match:
            try:
                return json.loads(json_match.group(0))
            except json.JSONDecodeError as e:
                print(f"ะัะธะฑะบะฐ ะฟะฐััะธะฝะณะฐ JSON: {e}")
                return None
        else:
            print("JSON ะฝะต ะฝะฐะนะดะตะฝ ะฒ ะพัะฒะตัะต ะผะพะดะตะปะธ.")
            return None

    except Exception as e:
        print(f"ะัะธะฑะบะฐ ะฟัะธ ะฒัะทะพะฒะต Gemini API: {e}")
        return None



async def format_vacancy_gemini(text: str, vacancy_id: str, date: str | None = None) -> str:
    """
    ะคัะฝะบัะธั ะดะปั ััััะบัััะธัะพะฒะฐะฝะฝะพะณะพ ะพัะพัะผะปะตะฝะธั ะฒะฐะบะฐะฝัะธะธ ั ะฟะพะผะพััั Gemini API.
    ะะพะทะฒัะฐัะฐะตั ะณะพัะพะฒัะน ัะตะบัั ะฒ ะฝัะถะฝะพะผ ัะพัะผะฐัะต.
    """
    if date is None:
        date = datetime.now().strftime("%d.%m.%Y")
        
    print(f"[*] ะคะพัะผะฐัะธััะตะผ ะฒะฐะบะฐะฝัะธั ID: {vacancy_id} ะพั {date}...")
    
    # ะัะพะผะฟั ะดะปั Gemini, ะพะฑัะตะดะธะฝัััะธะน ัะธััะตะผะฝัั ะธ ะฟะพะปัะทะพะฒะฐัะตะปััะบัั ัะพะปะธ
    prompt = f"""
ะขั โ ัะตะดะฐะบัะพั ะฒะฐะบะฐะฝัะธะน.
ะะฐ ะฒัะพะด ัั ะฟะพะปััะฐะตัั ัะตะบัั ะฒะฐะบะฐะฝัะธะธ. ะขะฒะพั ะทะฐะดะฐัะฐ โ ะพัะพัะผะธัั ะตะณะพ ะฒ ััััะบัััะธัะพะฒะฐะฝะฝะพะผ ะฒะธะดะต ะดะปั ะฟัะฑะปะธะบะฐัะธะธ, ัััะพะณะพ ัะพะฑะปัะดะฐั ัะพัะผะฐั.

โก๏ธ ะะะะะ:
โ ะะธะบะพะณะดะฐ ะฝะต ัะดะฐะปัะน ะธ ะฝะต ะธะทะผะตะฝัะน HTML-ััะณะธ (<s>, <b>, <i> ะธ ะปัะฑัะต ะดััะณะธะต).
โ ะัะพะฑะตะฝะฝะพ ะฝะต ััะพะณะฐะน ััะณะธ ะฒะพะบััะณ ัะปะตะดัััะธั ัััะพะบ:
  * ยซะะ: ...ยป
  * ยซะกะฐะผะพะทะฐะฝัััะน: ...ยป
  * ยซ- ะะถะตะผะตัััะฝะฐั ะฒัะฟะปะฐัะฐ ะจัะฐั/ะะพะฝััะฐะบัยป
โ ะญัะธ ัะปะตะผะตะฝัั ะดะพะปะถะฝั ะพััะฐะฒะฐัััั ั ััะณะฐะผะธ ะฒ ะธััะพะดะฝะพะผ ะฒะธะดะต.
โ ะะธะบะพะณะดะฐ ะฝะต ะดะพะฑะฐะฒะปัะน ะธ ะฝะต ัะฑะธัะฐะน ัะตะณะธ <s> (ะธะปะธ ะปัะฑัะต ะดััะณะธะต HTML-ัะตะณะธ).
โ ะัะปะธ ะฒ ะธััะพะดะฝะพะผ ัะตะบััะต ัััะพะบะฐ ัะถะต ัะพะดะตัะถะธั <s>โฆ</s> โ ะพััะฐะฒะปัะน ะบะฐะบ ะตััั.
โ ะัะปะธ ะฒ ะธััะพะดะฝะพะผ ัะตะบััะต ัััะพะบะธ ะฑะตะท <s> โ ะฝะต ะดะพะฑะฐะฒะปัะน ะทะฐัะตัะบะธะฒะฐะฝะธะต ัะฐะผะพััะพััะตะปัะฝะพ.
โ ะะตัะตะฝะธะต ะพ ัะพะผ, ะบะฐะบะธะต ัััะพะบะธ ะดะพะปะถะฝั ะฑััั ะทะฐัััะบะฝััั, ะฟัะธะฝะธะผะฐะตััั ะฝะต ัะพะฑะพะน, ะฐ ะปะพะณะธะบะพะน ะดะพ ะฟะตัะตะดะฐัะธ ัะตะบััะฐ (ัั ัะฐะฑะพัะฐะตัั ัะพะปัะบะพ ั ะณะพัะพะฒัะผ ะฝะฐะฑะพัะพะผ ัะตะณะพะฒ).


โก๏ธ ะัะฐะฒะธะปะฐ ัะพัะผะฐัะธัะพะฒะฐะฝะธั:
โ ะ ะฝะฐะทะฒะฐะฝะธะธ ะดะพะปะถะฝะพััะธ ะฒัะตะณะดะฐ ัะบะฐะทัะฒะฐัั ะณัะตะนะด (Junior / Middle / Senior / Lead), ะตัะปะธ ะพะฝ ะตััั.
โ ะะฐะทะดะตะป ยซะัะดะตั ะฟะปััะพะผยป ะฒะบะปััะฐะตััั ะฒ ะพะฑัะธะน ัะฟะธัะพะบ ยซ๐ป ะขัะตะฑะพะฒะฐะฝะธัยป (ะฑะตะท ะพัะดะตะปัะฝะพะณะพ ะฑะปะพะบะฐ).
โ ะะฐะถะดัะน ะฟัะฝะบั ััะตะฑะพะฒะฐะฝะธะน โ ะพัะดะตะปัะฝะพะน ัััะพะบะพะน ั ะผะฐัะบะตัะพะผ.
โ ะะตะถะดั ัะฐะทะดะตะปะฐะผะธ ะธ ะฑะปะพะบะฐะผะธ ะฒะฐะบะฐะฝัะธะธ ะดะพะปะถะฝะฐ ะฑััั ัะพะฒะฝะพ 1 ะฟัััะฐั ัััะพะบะฐ.
โ ะ ัะตะบััะต ะฒะฐะบะฐะฝัะธะธ ะฝะต ะดะพะปะถะฝะพ ะฑััั 2 ะธ ะฑะพะปะตะต ะฟััััั ัััะพะบ ะฟะพะดััะด.
โ ะะต ัะดะฐะปัะน ะธ ะฝะต ัะพะบัะฐัะฐะน ะธะฝัะพัะผะฐัะธั, ะธัะฟะพะปัะทัะน ะฒัะต ะดะฐะฝะฝัะต ะธะท ัะตะบััะฐ.
โ ะะปะพะบ ยซโ๏ธ ะัะพะฑัะต ััะปะพะฒะธัยป ะฒะบะปััะฐะน ัะพะปัะบะพ ะตัะปะธ ะฒ ัะตะบััะต ัะตะฐะปัะฝะพ ะตััั ะดะฐะฝะฝัะต (NDA, ะบะพะป-ะฒะพ ััะฐะฟะพะฒ ะธะฝัะตัะฒัั, ะพัะพัะผะปะตะฝะธะต ะธ ั.ะด.).

โก๏ธ ะกัััะบัััะฐ ะธัะพะณะพะฒะพะณะพ ัะตะบััะฐ:

๐{vacancy_id}
๐ ะะฐัะฐ ะฟัะฑะปะธะบะฐัะธะธ: {date}

๐ฅ [ะะฐะทะฒะฐะฝะธะต ะดะพะปะถะฝะพััะธ] ([ะัะตะนะด])

๐ฐ ะะตัััะฝะฐั ััะฐะฒะบะฐ (ะฝะฐ ััะบะธ) ะดะพ:
- ะะถะตะผะตัััะฝะฐั ะฒัะฟะปะฐัะฐ ะจัะฐั/ะะพะฝััะฐะบั: [ััะผะผะฐ] RUB
- ะก ะพัััะพัะบะพะน ะฟะปะฐัะตะถะฐ "[ััะพะบ, ะฝะฐะฟัะธะผะตั: 35 ัะฐะฑะพัะธั ะดะฝะตะน]" ะฟะพัะปะต ะฟะพะดะฟะธัะฐะฝะธั ะฐะบัะฐ ([ะะบัะธัะพะฒะฐะฝะธะต ะตะถะตะผะตัััะฝะพ/ะฟะพะบะฒะฐััะฐะปัะฝะพะต/ะฝะต ัะบะฐะทะฐะฝะพ]):
  ะะ: [ััะผะผะฐ] RUB,
  ะกะฐะผะพะทะฐะฝัััะน: [ััะผะผะฐ] RUB

๐ ะะพะบะฐัะธั/ะัะฐะถะดะฐะฝััะฒะพ: [ัััะฐะฝั, ะณะพัะพะดะฐ]
๐ ะคะพัะผะฐั ัะฐะฑะพัั: [ัะดะฐะปัะฝะฝะพ / ะพัะธั / ะณะธะฑัะธะด]
๐ ะัะตะนะด: [Junior / Middle / Senior / Lead]
๐ ะกัะพะบ ะฟัะพะตะบัะฐ: [ััะพะบะธ]
๐ ะกัะฐัั ะฟัะพะตะบัะฐ: [ASAP ะธะปะธ ะดะฐัะฐ]

๐ ะ ะฟัะพะตะบัะต:
[ะัะฐัะบะพะต ะพะฟะธัะฐะฝะธะต ะฟัะพะตะบัะฐ]

๐ ะะฐะดะฐัะธ:
โ [ะะตัะตัะธัะปะธัั ะทะฐะดะฐัะธ ะธะท ะฒะฐะบะฐะฝัะธะธ]

๐ป ะขัะตะฑะพะฒะฐะฝะธั:
โ [ะะฑัะทะฐัะตะปัะฝะพะต ััะตะฑะพะฒะฐะฝะธะต 1]
โ [ะะฑัะทะฐัะตะปัะฝะพะต ััะตะฑะพะฒะฐะฝะธะต 2]
โ [ะัะดะตั ะฟะปััะพะผ 1]
โ [ะัะดะตั ะฟะปััะพะผ 2]

โ๏ธ ะัะพะฑัะต ััะปะพะฒะธั:
โ [NDA, ะบะพะป-ะฒะพ ััะฐะฟะพะฒ ะธะฝัะตัะฒัั, ัััะดะพััััะพะนััะฒะพ ะธ ั.ะด.]

โ๏ธ ะะฑัะทะฐัะตะปัะฝัะต ะดะฐะฝะฝัะต ะฟะพ ะบะฐะฝะดะธะดะฐัั ะฟัะธ ะฟะพะดะฐัะต:
โ ะคะะ
โ ะกััะฐะฝะฐ + ะะพัะพะด
โ ะะฐัะฐ ัะพะถะดะตะฝะธั (ะฝะต ะฒะพะทัะฐัั, ะฐ ะดะฐัะฐ)
โ ะญะปะตะบััะพะฝะฝะฐั ะฟะพััะฐ
โ ะะฑัะฐะทะพะฒะฐะฝะธะต (ะะฃะ, ะณะพะด ะพะบะพะฝัะฐะฝะธั, ัะฟะตัะธะฐะปัะฝะพััั)
โ ะัะตะนะด
โ ะกัะฐะฒะบะฐ
โ ะงะตะบ-ะปะธัั ัะพะพัะฒะตัััะฒะธั ััะตะฑะพะฒะฐะฝะธัะผ (ะะ/ะะะข)

ะะพะฝัะฐะบั ะดะปั ะฒะพะฟัะพัะพะฒ: [ะธะผั + @Telegram]

---
ะะพั ัะตะบัั ะฒะฐะบะฐะฝัะธะธ ะดะปั ะพะฑัะฐะฑะพัะบะธ:

{text}
"""
    
    model = genai.GenerativeModel('gemini-2.5-flash')
    generation_config = genai.types.GenerationConfig(temperature=0.1)
    
    try:
        response = await model.generate_content_async(prompt, generation_config=generation_config)
        return response.text.strip()
    except Exception as e:
        print(f"๐ฅ ะัะธะฑะบะฐ ะฟัะธ ัะพัะผะฐัะธัะพะฒะฐะฝะธะธ ะฒะฐะบะฐะฝัะธะธ: {e}")
        return False


async def generate_hashtags_gemini(vacancy_text: str) -> str:
    """
    ะะตะฝะตัะธััะตั ััััะตะณะธ ะธะท ัะตะบััะฐ ะฒะฐะบะฐะฝัะธะธ ั ะฟะพะผะพััั Gemini API.
    """
    print("[*] ะะตะฝะตัะธััะตะผ ััััะตะณะธ...")
    
    prompt = f"""
ะะพั ัะตะบัั ะฒะฐะบะฐะฝัะธะธ:

{vacancy_text}

ะกัะพัะผะธััะน ัะฟะธัะพะบ ััััะตะณะพะฒ ะฒ ะพะดะฝั ัััะพะบั ัะตัะตะท ะฟัะพะฑะตะป.

ะัะฐะฒะธะปะฐ:
1. ะะพ ัะตัะฝะพะปะพะณะธัะผ/ััะตะบั (ะฝะฐะฟัะธะผะตั: #Java #Spring #PostgreSQL #Docker) โ ะธะทะฒะปะตะบะธ ะธั ะธะท ะพะฟะธัะฐะฝะธั.
2. ะะพ ะณัะตะนะดั: #Junior ะธะปะธ #Middle ะธะปะธ #Senior โ ะพะฟัะตะดะตะปะธ ะธะท ัะตะบััะฐ.
3. ะะพ ะพััะฐัะปะธ (ะฝะฐะฟัะธะผะตั: #Fintech #Retail #Banking) โ ะพะฟัะตะดะตะปะธ ะฟะพ ะบะพะฝัะตะบััั.

ะัะฒะตะดะธ ัะพะปัะบะพ ัััะพะบั ั ััััะตะณะฐะผะธ.
"""
    
    model = genai.GenerativeModel('gemini-2.5-flash')
    generation_config = genai.types.GenerationConfig(temperature=0.1)
    
    try:
        response = await model.generate_content_async(prompt, generation_config=generation_config)
        return response.text.strip()
    except Exception as e:
        print(f"๐ฅ ะัะธะฑะบะฐ ะฟัะธ ะณะตะฝะตัะฐัะธะธ ััััะตะณะพะฒ: {e}")
        return False



def sverka_vac_and_resume_json(vacancy_text: str, resume_text: str):
    print("[*] ะกะฒะตััะตะผ ะฒะฐะบะฐะฝัะธั ะธ ัะตะทัะผะต (ะทะฐะฟัะพั JSON)...")
    
    # 1. ะะฟัะตะดะตะปัะตะผ ะถะตะปะฐะตะผัะน ัะพัะผะฐั JSON


    prompt = f"""
  ะขั โ ะฐะฝะฐะปะธัะธะบ ะฟะพ ะฝะฐะนะผั. 
ะขะฒะพั ะทะฐะดะฐัะฐ โ ะะะะะะะะะะะะะะะขะฌ ะฟัะตะดะพััะฐะฒะปะตะฝะฝัะน ัะตะบัั, ะณะดะต ะพะฟะธัะฐะฝะฐ ะฒะฐะบะฐะฝัะธั ะธ ัะฟะธัะพะบ ะบะฐะฝะดะธะดะฐัะพะฒ. 
ะขั ะดะพะปะถะตะฝ ะธะทะฒะปะตัั ะฒัั ะธะฝัะพัะผะฐัะธั ะธ ััััะบัััะธัะพะฒะฐัั ะตั ัััะพะณะพ ะฟะพ ัะฐะฑะปะพะฝั ะฝะธะถะต, ะฒะพะทะฒัะฐัะฐั ัะตะทัะปััะฐั **ะขะะะฌะะ ะฒ ัะพัะผะฐัะต JSON** (ะฑะตะท ะบะพะผะผะตะฝัะฐัะธะตะฒ ะธ ะฟะพััะฝะตะฝะธะน).  

ะะฝะฐะปะธะท ะฒัะฟะพะปะฝัะน ะฟะพ ะจะะะะ 1โ4:

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ะจะะ 1. ะะะะะะกะะฏ โ ะฒะพะทัะผะธ ะธะท ัะตะบััะฐ ะะกะ ัะปะตะดัััะตะต:
โข ะฝะฐะทะฒะฐะฝะธะต ะฟะพะทะธัะธะธ ะธ ะตั ID (๐);
โข ะณัะตะนะด (junior/middle/senior/lead/etc.);
โข ะปะพะบะฐัะธั, ะณัะฐะถะดะฐะฝััะฒะพ ะธ ัะฐัะพะฒะพะน ะฟะพัั (ะตัะปะธ ัะบะฐะทะฐะฝั);
โข ัะพัะผะฐั ัะฐะฑะพัั (remote / office / hybrid);
โข ะพะฑัะทะฐัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั (must-have) โ ะฒัะต ัะฒะฝะพ ัะบะฐะทะฐะฝะฝัะต ััะตะฑะพะฒะฐะฝะธั;
โข ะดะพะฟะพะปะฝะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั (nice-to-have) โ ะฒัั, ััะพ ะฟะพะผะตัะตะฝะพ ะบะฐะบ ยซะฑัะดะตั ะฟะปััะพะผยป, ยซะถะตะปะฐัะตะปัะฝะพยป, ยซะพะฟัะธะพะฝะฐะปัะฝะพยป ะธ ั. ะฟ.;
โข ััะตะบ ัะตัะฝะพะปะพะณะธะน (ะฒัะต ัะตัะฝะพะปะพะณะธะธ, ััะตะนะผะฒะพัะบะธ, ัะทัะบะธ, ะธะฝััััะผะตะฝัั);
โข ะพัะพะฑัะต ััะปะพะฒะธั (ััะฐะฒะบะฐ, NDA, SIM-ะบะฐััะฐ, ััะพะบะธ, ะดะตะดะปะฐะนะฝั, ะพะฟะปะฐัะฐ, ะณัะฐัะธะบ, ะปะธะผะธัั ะธ ะฟั.);
โข ะฝะธะบ Telegram ะผะตะฝะตะดะถะตัะฐ (ะตัะปะธ ัะฟะพะผัะฝัั).

๐งฉ JSON:
{{
  "position": "",
  "vacancy_id": "",
  "grade": "",
  "location": "",
  "citizenship": "",
  "timezone": "",
  "format": "",
  "must_have": [""],
  "nice_to_have": [""],
  "tech_stack": [""],
  "special_conditions": [""],
  "manager_nick": ""
}}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ะจะะ 2. ะะะะะซะ ะะะะะะะะข โ ะธะท ัะตะบััะฐ ะฝัะถะฝะพ ะฒะทััั:
โข ะคะะ ะธะปะธ ะคะ (ะตัะปะธ ะพััะตััะฒะพ ัะบะฐะทะฐะฝะพ โ ะดะพะฑะฐะฒะธัั);
โข ะดะฐัั ัะพะถะดะตะฝะธั (ัะพัะผะฐัะธัะพะฒะฐัั: "ะะ.ะะ.ะะะะ (N ะปะตั)");
โข ะณะพัะพะด ะธ ัััะฐะฝั ะฟัะพะถะธะฒะฐะฝะธั;
โข ะณัะตะนะด ะธ ะฟะพะทะธัะธั (ะตัะปะธ ัะบะฐะทะฐะฝั);
โข ะพะฟัั โ ะฟะพะดัะพะฑะฝะพ ะฟะตัะตัะธัะปะธัั ะบะพะผะฟะฐะฝะธะธ, ะดะพะปะถะฝะพััะธ, ะดะพะผะตะฝั, ะฟัะพะตะบัั (ั ะพะฟะธัะฐะฝะธะตะผ ะทะฐะดะฐั, ัะพะปะตะน ะธ ัะตัะฝะพะปะพะณะธะน);
โข ััะตะบ ัะตัะฝะพะปะพะณะธะน (ะฒัะต ัะทัะบะธ, ััะตะนะผะฒะพัะบะธ, ะธะฝััััะผะตะฝัั);
โข ัะทัะบะธ (ััะพะฒะตะฝั, ะตัะปะธ ัะบะฐะทะฐะฝ);
โข ะบะพะฝัะฐะบัั (ัะตะปะตัะพะฝ, Telegram, email);
โข ะพัะตะฝะบั ะฟะพะปะฝะพัั ะพัะพัะผะปะตะฝะธั ะฟัะพัะธะปั (ะฟะพ ะฝะฐะปะธัะธั ะฟัะพะตะบัะพะฒ ะธ ะพะฟะธัะฐะฝะธั).

๐งฉ JSON:
{{
  "full_name": "",
  "birth_date": "",
  "city": "",
  "country": "",
  "grade": "",
  "position": "",
  "experience": {{
    "companies": [""],
    "roles": [""],
    "domains": [""],
    "projects": [
      {{
        "name": "",
        "description": "",
        "tech_stack": [""],
        "responsibilities": [""]
      }}
    ]
  }},
  "tech_stack": [""],
  "languages": [""],
  "contacts": [""],
  "structure_check": "ะะพะปะฝะฐั / ะงะฐััะธัะฝะฐั / ะััััััะฒัะตั"
}}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ะจะะ 3. ะกะะะขะะะขะกะขะะะ ะขะะะะะะะะะฏะ โ ะดะปั ะบะฐะถะดะพะณะพ ะบะฐะฝะดะธะดะฐัะฐ ัะพััะฐะฒั ัะฐะฑะปะธัั:

ะะปะพะบ 1 โ ะะะฏะะะขะะะฌะะซะ
  โข ะฒะพะทัะผะธ ะฒัะต ััะตะฑะพะฒะฐะฝะธั ะธะท must-have ะฒะฐะบะฐะฝัะธะธ;
  โข ะพัะตะฝะธ ะฟะพ ัะตะบััั ะบะฐะฝะดะธะดะฐัะฐ: 
    - ยซะะฐยป โ ัะฒะฝะพ ะฟะพะดัะฒะตัะถะดะตะฝะพ (ัะบะฐะทะฐะฝ ะพะฟัั, ะณะพะด, ะฟัะพะตะบั, ััะพะฒะตะฝั);
    - ยซะะตั (ััะพัะฝะธัั)ยป โ ะฝะตััะฝะพ, ะฝะตะดะพััะฐัะพัะฝะพ ะดะฐะฝะฝัั;
    - ยซะะตั (ัะพัะฝะพ ะฝะตั)ยป โ ะพััััััะฒัะตั ะธะปะธ ะฟัะพัะธะฒะพัะตัะธั ะพะฟะธัะฐะฝะธั.

ะะปะพะบ 2 โ ะะฃะะะข ะะะฎะกะะ
  โข ะฒะพะทัะผะธ ะฒัะต ะฟัะฝะบัั ะธะท nice-to-have ะธ ะพัะตะฝะธ: ยซะะฐยป / ยซะะตั (ััะพัะฝะธัั)ยป.

๐งฉ JSON:
{{
  "must_have": [
    {{
      "โ": 1,
      "requirement": "",
      "status": "ะะฐ / ะะตั (ััะพัะฝะธัั) / ะะตั (ัะพัะฝะพ ะฝะตั)",
      "comment": ""
    }}
  ],
  "nice_to_have": [
    {{
      "โ": 1,
      "requirement": "",
      "status": "ะะฐ / ะะตั (ััะพัะฝะธัั)",
      "comment": ""
    }}
  ]
}}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ะจะะ 4. ะะขะะ ะะ ะะะะะะะะขะฃ
โข ะกะดะตะปะฐะน ะพะฑัะธะน ะฒัะฒะพะด:
  - ยซะะพะดัะพะดะธัยป โ ะตัะปะธ ะฒัะต must-have = ะะฐ;
  - ยซะัะถะฝะพ ััะพัะฝะตะฝะธะตยป โ ะตัะปะธ ะตััั ัะพัั ะฑั ะพะดะธะฝ ะฟัะฝะบั ยซะะตั (ััะพัะฝะธัั)ยป;
  - ยซะัะบะฐะทยป โ ะตัะปะธ ะตััั ัะพัั ะฑั ะพะดะธะฝ ะฟัะฝะบั ยซะะตั (ัะพัะฝะพ ะฝะตั)ยป.
โข ะะพะฑะฐะฒั ะทะฐัะฟะปะฐัะฝัะต ะพะถะธะดะฐะฝะธั (ะตัะปะธ ัะบะฐะทะฐะฝั), ะธะฝะฐัะต ยซะฝัะถะฝะพ ััะพัะฝะธััยป.

๐งฉ JSON:
{{
  "result_status": "ะะพะดัะพะดะธั / ะัะถะฝะพ ััะพัะฝะตะฝะธะต / ะัะบะฐะท",
  "salary_expectations": ""
}}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
๐ค ะะซะะะ:
ะะตัะฝะธ ัััะพะณะพ ะพะดะธะฝ JSON ะฒ ัะพัะผะฐัะต:
{{
  "vacancy": {{...}},
  "candidates": [...],
  "comparison_tables": {{...}},
  "candidate_results": [...]
}}

โ๏ธะะต ะดะพะฑะฐะฒะปัะน ะฟะพััะฝะตะฝะธะน, ัะตะบััะฐ, markdown, ะบะพะผะผะตะฝัะฐัะธะตะฒ ะธะปะธ ะทะฐะณะพะปะพะฒะบะพะฒ.
ะัะฒะพะด โ ัะพะปัะบะพ ัะธัััะน JSON.
    
    ะะพั ัะตะบัั ะฒะฐะบะฐะฝัะธะธ:
    
    {vacancy_text}
    
    ะะพั ัะตะบัั ัะตะทัะผะต:
    
    {resume_text}
    """
    
    model = genai.GenerativeModel('gemini-2.5-flash')
    # ะขะตะผะฟะตัะฐัััะฐ 0.1 ะพัะปะธัะฝะพ ะฟะพะดัะพะดะธั ะดะปั ะทะฐะดะฐั ะธะทะฒะปะตัะตะฝะธั ะธ ััััะบัััะธัะพะฒะฐะฝะธั
    generation_config = genai.types.GenerationConfig(temperature=0.1)
    
    try:
        response = model.generate_content(prompt, generation_config=generation_config)
        
        # ะะพะดะตะปั ะดะพะปะถะฝะฐ ะฒะตัะฝััั ัะพะปัะบะพ JSON, ะฝะพ ะตัะปะธ ะพะฝะฐ ะดะพะฑะฐะฒะธั ะฟะพััะฝะตะฝะธั,
        # ััะพั ัะฐะณ ะผะพะถะตั ะฟะพััะตะฑะพะฒะฐัั ะดะพะฟะพะปะฝะธัะตะปัะฝะพะน ะพัะธััะบะธ ัััะพะบะธ.
        # ะะปั ะฝะฐัะฐะปะฐ ะฟัะพััะพ ะฒะพะทะฒัะฐัะฐะตะผ ัะตะบัั.
        return response.text.strip() 
        
    except Exception as e:
        print(f"๐ฅ ะัะธะฑะบะฐ ะฟัะธ ัะฒะตัะบะต ะฒะฐะบะฐะฝัะธะธ ะธ ัะตะทัะผะต: {e}")
        return False


